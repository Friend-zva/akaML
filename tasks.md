## Задачи (и дедлайны для ПИшек)

Задания [парные](/pairing.md). Ожидается, что вы будете свободно знать код напарника. Практикуйте парное программирование и т.п.

|   | Название        | Дедлайн |        |
| - | --------------- | ------- | ------ |
| 1 | Факториал в ANF | 4.10    |        |
| 2 | ANF             | 18.10   |        |
| 3 | runtime         | 25.10   |        |
| 4 | LL  + CC        |  1.11   |        |
| 5 | GC              |  8.11   |        |
| 6 | Tuples          | 15.11   |        |
| 7 | LLVM            |   ?     |        |
| 8 |                 |         |        |
| 9 |                 |         |        |

<!--
| 6 | typechecker
| 7 | QuickCheck+NestedComment+mutual+TypeAnnot |  |
| 8 | LLVM w/o GC |
| - | --------------- | ------- | ----- |
|   | Bools, `&&`, `||` ..... |  |
| 9 | User-defined operators.
| 9 | Smart Regalloc
|   | Algebraic
|   | SelectableCallingConv |
|   | modules?
|   | ARM/AMD64 codegen?

-->

#### 1. Факториал

Написать компилятор факториала в RISC-V 64. Достаточно, чтобы компилятор работал на одном примере --- [факториале](/manytests/typed/010fac_anf.ml).

* Тайпчекер, ANF, quickcheck --- можно отложить на потом.
* Ответ можно выдавать как exit code, либо встроить в язык стандартную функцию `exit: int -> 'a`
* Разумеется нужны cram тесты

#### 2. ANF

* Реализовать ANF-преобразование, чтобы уместь писать человеческие вычисления факториалов и чисел Фибоначчи
* Реализовать в рантайме функцию, которая позволит печатать числа.
* Тесты. Факториал/фибоначчи + про печать.

    ```
      $ cat > test.ml << EOF
      > let large x = if 0<>x then print_int 0 else print_int 1
      > let main =
      >   let x = if (if (if 0
      >                   then 0 else (let t42 = print_int 42 in 1))
      >               then 0 else 1)
      >           then 0 else 1 in
      >   large x
      > EOF
    ```


#### 2.99999

За бинари в репо будет ставиться минус, даже если я их уже помержил. Вытирайте

За списанное тоже будет минус

И за орущий линтер тоже (по модулю ложных срабатываний)

Постарайтесь также не копировать себе мои тесты, и брать их по сиволической ссылке, чтобы мне не пришлось задумываться не поменяны ли они так, чтобы было удобнее.

#### 3. Runtime

Сделать рантайм, который умеет частичное применение.
Задумывается, что на 3м дедлайне вы научитесь компилировать программы, которые будут получаться после LL+CC на 4м дедлайне

Тест про [факториал](/manytests/typed/010faccps_ll.ml) и [фибоначчи](/manytests/typed/010fibcps_ll.ml)


#### 4. LL+CC

СС --- избавление от замыканий тем или иным способом.

Lambda-lifting --- избавление от вложенных функций

У вас должны заработать CPSные [факториал](/manytests/typed/012faccps.ml) и [фибоначчи](/manytests/typed/012fibcps.ml). Также я хочу проверить, что функции с десятком аргументов вполне применяются: [вот](/manytests/typed/004manyargs.ml)

N.B. нельзя выключать анализы линтера, если это не согласовано со мною

#### 5. GC

Простой копирующий сборщик мусора, учитывающий, что в языке есть целые числы и замыкания. Нужно поддержать соответсвующий API

  * `get_heap_start(get_heap_fin): unit -> int` возвращают границы кучи, чтобы их потом распечатывать в компилируемой программе, например, размер кучи
  * `collect: unit -> unit` чтобы запустить сборку мусора
  * `print_gc_status: unit -> unit` распечатывает текущий банк памяти, выделенную в куче память на текущий момент, сколько выделилось с начала работы программы, количество проведенных сборок мусора и т.п.

#### 6. Tuples

#### 7. LLVM
